# 典型回答


[✅Redis的持久化机制是怎样的？](https://www.yuque.com/hollis666/qyhor6/zc5q70)



Redis提供了两种持久化的机制，分别是RDB和AOF。AOF和RDB各自有优缺点，为了让用户能够同时拥有上述两种持久化的优点， Redis 4.0 推出了 RDB-AOF 混合持久化。



在开启混合持久化的情况下，AOF 重写时会把 Redis 的持久化数据，以 RDB 的格式写入到 AOF 文件的开头，之后的数据再以 AOF 的格式化追加的文件的末尾。



那么，有了这个机制之后，**能保证Redis的数据一定不丢吗？**



**不能！**

****

首先Redis是基于内存存储的，虽然有了RDB和AOF的持久化机制，当Redis进程异常退出或服务器断电等情况发生时，内存中的数据可能会丢失。



有一种极端情况，那就是AOF这个持久化方案中，有一种Always的写回策略，即同步写回。也就是说每个写命令执行完，立马同步地将日志写回磁盘；



[✅RDB和AOF的写回策略分别是什么？](https://www.yuque.com/hollis666/qyhor6/utk3q3u7zwvtsv3a)



但是即使是在always策略下，也不能保证100%不丢失数据的，主要出于以下原因：



1. **磁盘和系统故障**：如果在写入操作和同步到磁盘之间发生硬件故障或系统崩溃，可能会丢失最近的写操作。



2. **操作系统缓冲区**：即使Redis请求立即将数据同步到磁盘，操作系统的I/O缓冲区可能会导致实际写入磁盘的操作延迟发生。如果在写入缓冲区之后，没写磁盘前，机器挂了，那么数据就丢了。



> <font style="color:rgb(15, 15, 15);">操作系统缓冲区，通常指的是操作系统用于管理数据输入输出（I/O）的一种内存区域。当程序进行文件写入操作时，数据通常首先被写入到这个缓冲区，而不是直接写入到硬盘。</font>
>



3. **磁盘写入延迟**：磁盘的写入并非实时完成，特别是在涉及到机械硬盘时，写入延迟主要由磁盘旋转速度（RPM）和寻道时间决定。如果在这这个延迟过程中，机器挂了，那么数据也就丢了。





归根结底，Redis就不是用来干持久化的。要持久化，就用关系型数据库。

